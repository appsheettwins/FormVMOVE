<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>LIFF Form v1.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body { font-family: sans-serif; background:#f2f6ff; }
.card {
  max-width:420px; margin:auto; background:#fff;
  padding:20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.1);
}
img { width:90px; border-radius:50%; display:block; margin:auto; }
h3{text-align:center}
label{margin-top:10px; display:block}
input,select,button{
  width:100%; padding:10px; margin-top:5px;
  border-radius:8px; border:1px solid #ccc;
}
button{background:#4f46e5;color:#fff;font-size:16px;border:none}
.summary{display:none}
</style>
</head>

<body>
<div class="card">

<div id="form">
  <img id="pic">
  <h3 id="lineName"></h3>

  <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <input id="inputName">

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
  <input id="phone" type="tel" maxlength="10">

  <label>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
  <select id="activity" onchange="updateItems()">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° --</option>
  </select>

  <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
  <select id="item">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>
  </select>

  <button onclick="save()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="summary" class="summary">
  <h3>‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
  <div id="sumText"></div>
  <button onclick="resetForm()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
</div>

</div>

<script>
const LIFF_ID = "2008940385-hkDtMTsg";
const GAS_URL = "https://script.google.com/macros/s/AKfycbzHGWEA9JYbd1e9-cGnod10qrWuy-hz39IEDd1DhjkCa8bRP-D4qVLkGXNQbV2dcjNI/exec";

let profile = {};
let activityMap = {};

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) return liff.login();

  profile = await liff.getProfile();
  document.getElementById("pic").src = profile.pictureUrl;
  document.getElementById("lineName").innerText = profile.displayName;

  loadActivities();
}

async function loadActivities() {
  const res = await fetch(GAS_URL + "?mode=activity");
  const data = await res.json();

  activityMap = {};
  data.forEach(r => {
    if (!activityMap[r.activity]) activityMap[r.activity] = [];
    activityMap[r.activity].push(r.item);
  });

  const act = document.getElementById("activity");
  Object.keys(activityMap).forEach(a=>{
    act.innerHTML += `<option value="${a}">${a}</option>`;
  });
}

function updateItems() {
  const act = activity.value;
  item.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>';
  if (!activityMap[act]) return;
  activityMap[act].forEach(i=>{
    item.innerHTML += `<option value="${i}">${i}</option>`;
  });
}

async function save() {
  const payload = {
    userId: profile.userId,
    displayName: profile.displayName,
    profilename: profile.displayName,
    inputName: inputName.value,
    phone: phone.value,
    activity: activity.value,
    item: item.value
  };

  const res = await fetch(GAS_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  const r = await res.json();
  if (!r.success) return alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");

  form.style.display="none";
  summary.style.display="block";
  sumText.innerHTML = `
  üë§ ${payload.inputName}<br>
  üìû ${payload.phone}<br>
  üéØ ${payload.activity}<br>
  üìå ${payload.item}`;
}

function resetForm(){
  location.reload();
}

window.onload = init;
</script>
</body>
</html>
